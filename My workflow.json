{
  "name": "My workflow",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "dada61ab-b968-4f3d-84c1-d89d73a0497b",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        -1360,
        144
      ],
      "id": "33cb4de7-990f-4661-b896-a427c7202e93",
      "name": "Webhook",
      "webhookId": "dada61ab-b968-4f3d-84c1-d89d73a0497b"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.body.User_Request }}",
        "options": {
          "systemMessage": "# ROLE: Telco Security Firewall\nYou are a strict verification system. Your #1 rule is DATA PRIVACY. \nYou have access to \"customers\" and \"billings\" databases.\n\n# THE \"SILENT READ\" RULE (CRITICAL)\nWhen you use a tool to fetch customer data, you will see their Name, Email, and Phone.\n**YOU ARE FORBIDDEN FROM SPEAKING THESE VALUES.**\nYou may only output a database value IF AND ONLY IF the user has already typed that exact value in the chat.\n\n# VERIFICATION ALGORITHM (Execute Step-by-Step)\n\nSTEP 1: INITIAL INPUT\n- Ask for Name and Customer ID.\n- User says: \"I am [User_Input_Name], ID [User_Input_ID]\".\n\nSTEP 2: INTERNAL CHECK (Do This Silently)\n- Query the \"customers\" tool using [User_Input_ID].\n- Look at the \"name\" field in the result. Let's call this [DB_Real_Name].\n- COMPARE: Does [User_Input_Name] match [DB_Real_Name]?\n\nSTEP 3: THE DECISION POINT (Strict Branching)\n\nðŸ”´ IF NAMES DO NOT MATCH:\n   - **STOP IMMEDIATELY.**\n   - OUTPUT THIS EXACT PHRASE: \"Identity verification failed. The name provided does not match the Customer ID in our records.\"\n   - **SECURITY BAN:** Do NOT say \"The ID belongs to Maria.\" Do NOT mention the real name. Do NOT ask for the email.\n\nðŸŸ¢ IF NAMES MATCH:\n   - Say: \"Name confirmed. Please enter your registered email address to view billing details.\"\n   - Wait for [User_Input_Email].\n   - COMPARE [User_Input_Email] vs [DB_Real_Email].\n   - IF MISMATCH -> Say: \"Identity verification failed. Email does not match.\" (Do NOT reveal the real email).\n   - IF MATCH -> You may now fetch and show the billing info.\n\n# TECHNICAL SYNTAX\n- \"customer_id\" is a Number (e.g., 1002).\n- Do NOT use \"eq.\", quotes, or parentheses in the tool inputs.\n\n# FORMATTING RULES\n- Provide the response as a single, continuous line of text.\n- Do NOT use newlines (\\n), bullet points, or line breaks.\n- Use commas or semicolons to separate details instead."
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3.1,
      "position": [
        -1136,
        144
      ],
      "id": "31da3993-60a0-4817-b673-6a48f86aeb1e",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "1",
        "contextWindowLength": 10
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        -1136,
        352
      ],
      "id": "408af925-ef7c-458b-9459-b325cc68a8d9",
      "name": "Simple Memory"
    },
    {
      "parameters": {
        "model": "qwen/qwen3-coder",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
      "typeVersion": 1,
      "position": [
        -1264,
        352
      ],
      "id": "d97c25ff-4af1-4dc8-8a37-55095b76ec8b",
      "name": "OpenRouter Chat Model",
      "credentials": {
        "openRouterApi": {
          "id": "XeigWbZ4pLAmhe7P",
          "name": "OpenRouter account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.5,
      "position": [
        -832,
        128
      ],
      "id": "f8a2afd3-40d6-4d0c-8c9a-3efa6971c92f",
      "name": "Respond to Webhook"
    },
    {
      "parameters": {
        "fileSelector": "=/home/node/.n8n-files/files/*",
        "options": {}
      },
      "type": "n8n-nodes-base.readWriteFile",
      "typeVersion": 1.1,
      "position": [
        -2128,
        144
      ],
      "id": "4e019183-cf78-4d99-a75d-8df68bf4a523",
      "name": "Read/Write Files from Disk"
    },
    {
      "parameters": {
        "dataType": "binary",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.documentDefaultDataLoader",
      "typeVersion": 1.1,
      "position": [
        0,
        0
      ],
      "id": "04ed8c0a-3570-4377-ae7c-7925a2d3a005",
      "name": "Default Data Loader"
    },
    {
      "parameters": {
        "model": "qwen3-embedding:8b"
      },
      "type": "@n8n/n8n-nodes-langchain.embeddingsOllama",
      "typeVersion": 1,
      "position": [
        -1664,
        592
      ],
      "id": "232c5824-6e0a-4af5-98ea-56cf1ca71dfa",
      "name": "Embeddings Ollama"
    },
    {
      "parameters": {
        "mode": "retrieve-as-tool",
        "toolDescription": "Use this tool to search the company knowledge base for FAQs, policies, troubleshooting guides, and general support information. Use it when the user asks about company services, procedures, billing explanations, technical issues, or general inquiries that require documented information.\n",
        "tableName": {
          "__rl": true,
          "value": "documents",
          "mode": "list",
          "cachedResultName": "documents"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
      "typeVersion": 1.3,
      "position": [
        -1920,
        144
      ],
      "id": "6e332cfb-1cb7-4aa8-9d7d-a37509ff401e",
      "name": "vector store",
      "credentials": {
        "supabaseApi": {
          "id": "CyWSOo0TzJYQasFk",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "descriptionType": "manual",
        "toolDescription": "get billing information in supabase using the customer's 'customer_id'",
        "operation": "get",
        "tableId": "billing",
        "filters": {
          "conditions": [
            {
              "keyName": "customer_id",
              "keyValue": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('conditions1_Value', `The numeric ID of the customer (e.g., 1001). Do not provide strings or UUIDs.`, 'string') }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabaseTool",
      "typeVersion": 1,
      "position": [
        -688,
        352
      ],
      "id": "9dcd75b0-58f4-4a0b-89b0-ade575845beb",
      "name": "billings",
      "credentials": {
        "supabaseApi": {
          "id": "CyWSOo0TzJYQasFk",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "descriptionType": "manual",
        "toolDescription": "get customer account information using the customer's 'customer_id'",
        "operation": "get",
        "tableId": "customers",
        "filters": {
          "conditions": [
            {
              "keyName": "customer_id",
              "keyValue": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('conditions0_Value', `The numeric ID of the customer (e.g., 1001). Do not provide strings or UUIDs.`, 'string') }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabaseTool",
      "typeVersion": 1,
      "position": [
        -592,
        352
      ],
      "id": "fc231c14-da02-48bf-9e77-841fa5377788",
      "name": "customers",
      "credentials": {
        "supabaseApi": {
          "id": "CyWSOo0TzJYQasFk",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "descriptionType": "manual",
        "toolDescription": "Retrieve ticket information from the database using either a ticket_id or a customer_id. \n\nUse this tool when the user asks about ticket status, existing support requests, issue progress, or support history. \n\nThis tool returns real-time ticket data from the system.\n",
        "operation": "get",
        "tableId": "tickets",
        "filters": {
          "conditions": [
            {
              "keyName": "ticket_id",
              "keyValue": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('conditions0_Field_Value', ``, 'string') }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabaseTool",
      "typeVersion": 1,
      "position": [
        -496,
        352
      ],
      "id": "62a556a9-03c3-4ecf-af3b-8057e52a405c",
      "name": "tickets",
      "credentials": {
        "supabaseApi": {
          "id": "CyWSOo0TzJYQasFk",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "descriptionType": "manual",
        "toolDescription": "get network status from a location using the information provided by the user like their location id, city, and area code.",
        "operation": "getAll",
        "tableId": "network_status"
      },
      "type": "n8n-nodes-base.supabaseTool",
      "typeVersion": 1,
      "position": [
        -400,
        352
      ],
      "id": "701f641f-9fa9-43c4-8e3e-7a0eba54bf0c",
      "name": "network status",
      "credentials": {
        "supabaseApi": {
          "id": "CyWSOo0TzJYQasFk",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "mode": "retrieve-as-tool",
        "toolDescription": "contains about frequently asked questions by customers",
        "tableName": {
          "__rl": true,
          "value": "general knowledge",
          "mode": "list",
          "cachedResultName": "general knowledge"
        },
        "topK": 0,
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
      "typeVersion": 1.3,
      "position": [
        -992,
        368
      ],
      "id": "5d0e097d-58a0-4c87-85fa-cb6a52e58fe9",
      "name": "knowledge base",
      "credentials": {
        "supabaseApi": {
          "id": "CyWSOo0TzJYQasFk",
          "name": "Supabase account"
        }
      }
    }
  ],
  "pinData": {},
  "connections": {
    "Webhook": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Simple Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent": {
      "main": [
        [
          {
            "node": "Respond to Webhook",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings Ollama": {
      "ai_embedding": [
        [
          {
            "node": "vector store",
            "type": "ai_embedding",
            "index": 0
          },
          {
            "node": "knowledge base",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "OpenRouter Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "billings": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "customers": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "tickets": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "network status": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "knowledge base": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1",
    "binaryMode": "separate",
    "availableInMCP": false
  },
  "versionId": "e9a7df06-49c2-4292-92d5-30b2b20e32fb",
  "meta": {
    "instanceId": "fcfe4524afe8a6b4d6cd712b849daa018736ed41dfc1cd22259344ff8d61665d"
  },
  "id": "E4pkQapg2WkblObY-voiv",
  "tags": []
}